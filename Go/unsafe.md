# unsafe

### unsafe.Sizeof, Alignof 和 Offsetof

- 函数 unsafe.Sizeof 报告传递给它的参数在内存中占用的字节，这个参数可以是任何类型的表达式，不会计算表达式。Sizeof 调用返回一个 uintptr 类型的常量表达式，所以这个结果可以作为数组类型的维度或者用于计算其他的常量。

- 函数 unsafe.Alignof 报告它参数类型所要求的对齐方式。和 Sizeof 一样，它的参数可以是任意类型的表达式，并且返回一个常量。典型的，布尔类型和数值类型对齐到他们的长度，而其他的类型则按字节对齐。

- 函数 unsafe.Offsetof，计算成员 f 相对于结构体 x 起始地址的偏移值，如果有内存空位，也计算在内，该函数的操作数必须是一个成员选择器 x.f。


### unsafe.Pointer

unsafe.Pointer 类型是一种特殊类型的指针，它可以存储任何变量的地址。当然，我们无法间接地通过一个 unsafe.Pointer 变量来使用 *p，因为我们不知道这个表达式地具体类型。和普通的指针一样，unsafe.Pointer 类型的指针是可比较的并且可以和 nil 做比较，nil 是指针类型的零值。

一个普通的指针 *T 可以转换为 unsafe.Pointer 类型的指针，另外一个 unsafe.Pointer 类型的指针也可以转换回普通指针，而且可以不必和原来的类型 *T 相同。

也可以通过结果指针来更新位模式。这个对一个浮点类型的变量来说是无害的，但是通常使用 unsafe.Pointer 进行类型转换可以让我们将任意值写入内存中，并因此破坏了类型系统。

unsafe.Pointer 类型也可以转换为 uintptr 类型，uintptr 类型保存了指针所指向地址的数值，这就可以让我们对地址进行数值计算。这种转换当然也可以反过来，但是这种从 uintptr 到 unsafe.Pointer 的转换也会破坏类型系统，因为并不是所有的数值都是合法的内存地址。