# 安全模式

Nomad是一个灵活的编排工具，以统一的方式管理单应用程序和容器。

- mTLS
    对TLS服务和客户端 x509证书双向认证，避免集群内部出现对网络组件的未授权访问。
- ACLs
    通过授予token允许role申请授权的链接。
- Namespaces（企业版）。。。

## 角色

- System Administrator
    拥有权限访问、执行Nomad二进制文件。
- Nomad Administrator
    拥有权限定义服务和客户端的配置。拥有完全的权限在集群内开启、停止job。
- Nomad Operator
    拥有部分权限管理job。
- User
    有应用运行在Nomad系统上，没有权限调用Nomad API。

## 安全配置

Nomad没有默认的安全配置，如果不按下面的策略配置Nomad，就可能会出现安全问题。

- mTLS
    - Mutual TLS(mTLS)实现双向认证，避免出现未授权访问。因为客户端和服务端都必须提供有效的CA证书签名的有效的TLS X.509证书。
    - 使用TLS可以避免通信内容被篡改。
    - 使用X.509 SAN扩展可以防止代理角色配置错误。
    - 使用前面的角色，可以防止恶意伪装的服务端或者客户端。
- ACL
    访问控制列表，允许为个人配置特定的权限。

- 哨兵策略（企业版使用。。。）

## 建议

- 轮换凭证
    - 使用Cault创建和管理动态的轮换凭证。
    - 使用Vault的PKI秘密引擎集成，为每个Nomad节点自动生成和更新X.509证书。
- 非Root运行
    Nomad服务可以以非Root权限下运行。
- 具有沙盒runtime的容器。
- 禁用不使用的驱动程序。
- 使用Linux上的AppArmor、SELinux和Seccomp等操作系统中的安全模块，应用于容器以提供额外的安全层。
- 集成服务网络技术（例如Consul）对限制集群中的网络连接并有效地进行负载平衡非常有用。
- TLS设置应适应环境的需求。
- 可以为HTTP API相应配置其他安全表头，例如：X-XSS-Protection。

## 威胁模型

- Nomad通信之间需要加密。
- 传输的数据需要防篡改。
- 未授权访问。
- 恶意消息。
- 非服务器成员访问原始数据。
- 针对单个节点的DDoS攻击。
